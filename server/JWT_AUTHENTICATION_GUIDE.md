# üîê JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üéØ **–ö–∞–∫ —ç—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### **–î–û (—Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ):**
```rust
// –í–æ–∑–≤—Ä–∞—â–∞–ª —Å–ª—É—á–∞–π–Ω—ã–π UUID
let user_info = UserInfo {
    id: Uuid::new_v4(), // ‚ùå –°–ª—É—á–∞–π–Ω—ã–π ID –∫–∞–∂–¥—ã–π —Ä–∞–∑
    username: "demo_user".to_string(), // ‚ùå –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
};
```

### **–ü–û–°–õ–ï (—Ä–µ–∞–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è):**
```rust
// 1. –ò–∑–≤–ª–µ–∫–∞–µ–º user_id –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
let user_id = extract_user_id_from_request(&req, &jwt_service).await?;

// 2. –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ —ç—Ç–æ–º—É ID
let user = user_auth_repository.find_by_id(user_id).await?;

// 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –†–ï–ê–õ–¨–ù–´–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
let user_info = UserInfo {
    id: user.id,           // ‚úÖ –†–µ–∞–ª—å–Ω—ã–π ID –∏–∑ –ë–î
    username: user.username, // ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    first_name: user.first_name,
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –∏–∑ –ë–î
};
```

## üîÑ **–ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

### 1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
```bash
curl -X POST http://localhost:8080/v1/login \
  -H "Content-Type: application/json" \
  -d '{"username": "maxnemoy", "password": "qwerty"}'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": { ... }
}
```

### 2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ**
```bash
curl -X GET http://localhost:8080/v1/user \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: Bearer <token>`
2. JWT —Ç–æ–∫–µ–Ω –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `user_id`
3. –ü–æ `user_id` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL –∑–∞–ø—Ä–æ—Å –∫ –ë–î
4. –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è **—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏–∑ PostgreSQL

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```bash
curl -X PATCH http://localhost:8080/v1/user \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{"first_name": "–ù–æ–≤–æ–µ –∏–º—è", "last_name": "–ù–æ–≤–∞—è —Ñ–∞–º–∏–ª–∏—è"}'
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**
1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `user_id` –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL UPDATE –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è **–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –∏–∑ –ë–î

## üîí **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

### **JWT –¢–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç:**
```json
{
  "sub": "123e4567-e89b-12d3-a456-426614174000", // user_id
  "email": "maxnemoy@gmail.com",
  "exp": 1703123456, // —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
  "iat": 1703037056, // –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è  
  "token_type": "access" // —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞
}
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞:**
```rust
// 1. –í–∞–ª–∏–¥–∞—Ü–∏—è JWT –ø–æ–¥–ø–∏—Å–∏
let token_data = jwt_service.verify_token(token)?;

// 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ user_id
let user_id = Uuid::parse_str(&token_data.claims.sub)?;

// 3. –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
let user = user_auth_repository.find_by_id(user_id).await?;
```

### **–û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

**401 Unauthorized:**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization`
- –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ (–Ω–µ `Bearer ...`)
- –ò—Å—Ç–µ–∫—à–∏–π –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π JWT —Ç–æ–∫–µ–Ω

**404 Not Found:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID –∏–∑ —Ç–æ–∫–µ–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î (–±—ã–ª —É–¥–∞–ª–µ–Ω)

**400 Bad Request:**
- –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization

## üìä **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:**

### ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
- –¢–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

### ‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –ë–î
- –û—Ç—Ä–∞–∂–∞—é—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É

### ‚úÖ **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å:**
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω –∏–∑ –ë–î ‚Üí 404 –æ—à–∏–±–∫–∞
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø–æ–¥–¥–µ–ª–∞–Ω ‚Üí 401 –æ—à–∏–±–∫–∞  
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ ‚Üí 401 –æ—à–∏–±–∫–∞

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

### 1. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω:**
```bash
TOKEN=$(curl -s -X POST http://localhost:8080/v1/login \
  -H "Content-Type: application/json" \
  -d '{"username": "maxnemoy", "password": "qwerty"}' | \
  jq -r '.access_token')
```

### 2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω:**
```bash
curl -X GET http://localhost:8080/v1/user \
  -H "Authorization: Bearer $TOKEN"
```

### 3. **–û–±–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:**
```bash
curl -X PATCH http://localhost:8080/v1/user \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"first_name": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –∏–º—è"}'
```

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

**–¢–µ–ø–µ—Ä—å GET /v1/user –∏ PATCH /v1/user –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –†–ï–ê–õ–¨–ù–û–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ PostgreSQL –ë–î –Ω–∞ –æ—Å–Ω–æ–≤–µ JWT —Ç–æ–∫–µ–Ω–∞, –∞ –Ω–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è!**
